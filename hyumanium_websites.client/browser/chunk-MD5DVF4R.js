import{Ua as n,Ya as l,Za as h,g as u,m as c,o as s,q as i,qa as p}from"./chunk-ZLSFG767.js";var a=class r{constructor(e,t){this.http=e;this.router=t;this.checkExistingSession()}API_URL=l.apiUrl;currentUserSubject=new u(null);currentUser$=this.currentUserSubject.asObservable();redirectUrl="/";checkExistingSession(){let e=this.getToken(),t=localStorage.getItem("currentUser");if(e&&t)try{let o=JSON.parse(t);this.currentUserSubject.next(o)}catch(o){console.error("Error parsing stored user data:",o),this.clearSession()}}sendOtp(e){return this.http.post(`${this.API_URL}/auth/send-otp`,e)}verifyOtp(e){return this.http.post(`${this.API_URL}/auth/verify-otp`,e)}completeRegistration(e){return this.http.post(`${this.API_URL}/auth/complete-registration`,e).pipe(c(t=>{t.success&&t.data&&this.setSession(t.data)}))}login(e){return this.http.post(`${this.API_URL}/auth/login`,e).pipe(c(t=>{t.success&&t.data&&this.setSession(t.data)}))}logout(){this.http.post(`${this.API_URL}/auth/logout`,{}).subscribe(),this.clearSession(),this.router.navigate(["/"])}resendOtp(e){return this.http.post(`${this.API_URL}/auth/resend-otp`,e)}sendEmailVerification(){return this.http.post(`${this.API_URL}/auth/send-email-verification`,{})}verifyEmail(e){return this.http.post(`${this.API_URL}/auth/verify-email`,e)}setSession(e){localStorage.setItem("accessToken",e.token),localStorage.setItem("refreshToken",e.refreshToken),localStorage.setItem("tokenExpiry",e.expiresAt.toString()),localStorage.setItem("currentUser",JSON.stringify(e.user)),this.currentUserSubject.next(e.user)}clearSession(){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("tokenExpiry"),localStorage.removeItem("currentUser"),this.currentUserSubject.next(null)}getToken(){return localStorage.getItem("accessToken")}getRefreshToken(){return localStorage.getItem("refreshToken")}isAuthenticated(){let e=this.getToken(),t=localStorage.getItem("tokenExpiry");if(!e||!t)return!1;let o=new Date(t);return new Date>=o?(this.clearSession(),!1):!0}getCurrentUser(){return this.currentUserSubject.value}hasRole(e){let t=this.getCurrentUser();return t?typeof e=="string"?h[t.role].toString()===e:t.role===e:!1}getUserRole(){let e=this.getCurrentUser();return e?e.role:null}refreshToken(){let e=this.getRefreshToken();return this.http.post(`${this.API_URL}/auth/refresh`,{refreshToken:e})}static \u0275fac=function(t){return new(t||r)(i(p),i(n))};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var g=class r{constructor(e,t){this.authService=e;this.router=t}canActivate(e,t){return this.authService.isAuthenticated()?!0:(this.authService.redirectUrl=t.url,this.router.navigate(["/auth"],{queryParams:{returnUrl:t.url}}),!1)}static \u0275fac=function(t){return new(t||r)(i(a),i(n))};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};var R=class r{constructor(e,t){this.authService=e;this.router=t}canActivate(e){let t=e.data.expectedRole;return this.authService.getCurrentUser()?this.authService.hasRole(t)?!0:(this.authService.hasRole("Admin")?this.router.navigate(["/admin"]):this.authService.hasRole("Vendor")?this.router.navigate(["/vendor"]):this.authService.hasRole("Customer")?this.router.navigate(["/customer"]):this.router.navigate(["/"]),!1):(this.router.navigate(["/auth"]),!1)}static \u0275fac=function(t){return new(t||r)(i(a),i(n))};static \u0275prov=s({token:r,factory:r.\u0275fac,providedIn:"root"})};export{a,g as b,R as c};
